// Generated by CoffeeScript 1.3.3
var Atlas;(function(){var e,t,n,r,i;e=0,n=["ms","moz","webkit","o"];if(!window.requestAnimationFrame)for(r=0,i=n.length;r<i;r++)t=n[r],window.requestAnimationFrame=window[t+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t+"CancelAnimationFrame"]||window[t+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r,i,s;return r=(new Date).getTime(),s=Math.max(0,16-(r-e)),i=window.setTimeout(function(){return t(r+s)},s),e=r+s,i});if(!window.cancelAnimationFrame)return window.cancelAnimationFrame=function(e){return clearTimeout(e)}})(),CanvasRenderingContext2D.prototype.pinShape=function(e,t,n,r,i,s){var o,u;i==null&&(i=!1),s==null&&(s=!1),u={x:e+n/2,y:t+r/2},o={y:t+r/3},this.beginPath(),this.arc(u.x,t+r/3,n/2,Math.PI,0,!1),this.bezierCurveTo(e+n,o.y+r/4,u.x+n/3,u.y,u.x,t+r),this.moveTo(e,o.y),this.bezierCurveTo(e,o.y+r/4,u.x-n/3,u.y,u.x,t+r),i&&this.fill();if(s)return this.stroke()},Atlas=function(){function e(){this.maps=[]}return e.prototype.createMap=function(t){var n;return n=new e.Map(t),this.maps.push(n),n},e}(),Atlas.Map=function(){function e(e){this.options=e,this.container=this.options.container,this.markers=[],this.map=new google.maps.Map(document.getElementById(this.container),this.options)}return e.prototype.addMarker=function(e){var t;return t=new Atlas.MapMarker(e),this.markers.push(t),t},e.prototype.showMarkers=function(){var e,t,n,r,i;r=this.markers,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.setMap(this.map));return i},e.prototype.fitToMarkers=function(e){var t,n,r,i;e=e||this.markers,t=new google.maps.LatLngBounds;for(r=0,i=e.length;r<i;r++)n=e[r],t.extend(n.marker.getPosition());return this.map.fitBounds(t)},e}(),Atlas.MapMarker=function(){function e(e){var t;this.options=e,this.latitude=this.options.latitude||60,this.longitude=this.options.longitude||24,this.color=new jColour(this.options.color||"#f00"),this.size=this.options.size||24,this.width=this.size,this.height=this.size*1.5,this.minSize=this.size,this.maxSize=this.size*2,this.isGrown=!1,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),t={position:new google.maps.LatLng(this.latitude,this.longitude),title:this.options.title||"Untitled Marker",animation:this.options.animation||null},this.marker=new google.maps.Marker(t),this.options.map!=null&&(this.marker.setMap(this.options.map),this.render())}return e.prototype.setMap=function(e){return this.marker.setMap(e)},e.prototype.render=function(){return this.canvas.width=this.width,this.canvas.height=this.height+this.size/4,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.icon=this.createIcon(),this.marker.setIcon(this.icon)},e.prototype.createIcon=function(){var e,t,n,r,i,s,o,u,a,f,l;this.drawShadow(),e=new jColour(this.color.rgb()),n={start:e.lighten(5.5).hex(),end:e.darken(10).hex()},t=this.context.createLinearGradient(0,0,this.width,this.height),t.addColorStop(0,n.start),t.addColorStop(1,n.end),r=new jColour(this.color.rgb()),s={start:r.darken(10).transparentize(90).hex(),end:r.darken(15).transparentize(90).hex()},i=this.context.createLinearGradient(0,0,this.width,this.height),i.addColorStop(0,s.start),i.addColorStop(1,s.end),this.context.lineWidth=1.5,u=[[1.5,0,this.width-3.5,this.height,t,i],[2,1,this.width-4.25,this.height-2.5,(new jColour(this.color.rgb())).lighten(25).hex(),!1],[2,2.5,this.width-4.25,this.height-4,t,!1]];for(a=0,f=u.length;a<f;a++)o=u[a],this.context.fillStyle=o[4]?o[4]:!1,this.context.strokeStyle=o[5]?o[5]:!1,(l=this.context).pinShape.apply(l,o);return this.context.beginPath(),this.context.arc(this.width/2,this.height/3,this.width/6,Math.PI*2,0,!1),this.context.fillStyle="#fff",this.context.fill(),new google.maps.MarkerImage(this.canvas.toDataURL(),new google.maps.Size(this.width,this.canvas.height,new google.maps.Point(0,0,new google.maps.Point(this.width/2,this.height))))},e.prototype.drawShadow=function(){var e,t,n,r;return r={width:this.width/2,height:this.width/2},n={x:this.width/2-r.width/2,y:this.height-r.height},e={x:n.x+r.width/2,y:n.y+r.height/2},t=this.context.createRadialGradient(e.x,e.y,0,e.x,e.y,r.width/2),t.addColorStop(0,"rgba(0, 0, 0, 0.30)"),t.addColorStop(1,"rgba(0, 0, 0, 0)"),this.context.setTransform(1,0,0,.5,0,0),this.context.translate(0,this.height+r.height/2),this.context.fillStyle=t,this.context.fillRect(n.x,n.y,r.width,r.height),this.context.fill(),this.context.closePath(),this.context.setTransform(1,0,0,1,0,0)},e.prototype.drawPinShape=function(e,t,n,r,i,s){var o,u;u={x:e+n/2,y:e+r/2},o={y:t+r/3},this.context.beginPath(),this.context.arc(this.center.x,t+r/3,n/2,Math.PI,0,!1),this.context.bezierCurveTo(e+n,o.y+r/4,u.x+n/3,u.y,u.x,t+r),this.context.moveTo(e,o.bottom),this.context.bezierCurveTo(e,o.y+r/4,u.x-n/3,u.y,u.y,t+r),i&&(this.context.fillStyle=i,this.context.fill());if(s)return this.context.strokeStyle=s,this.context.stroke()},e.prototype.animateSize=function(e,t,n){var r,i=this;this.minSize=t,this.maxSize=n;if(this.isGrown&&e<=this.minSize){this.isGrown=!1;return}if(!this.isGrown&&size>=this.maxSize){this.isGrown=!0;return}return r=this.isGrown?e-1:e+1,this.width=r,this.height=r*1.5,requestAnimationFrame(function(){return i.animateSize(r,t,n)})},e}(),window.Atlas=Atlas;